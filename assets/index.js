(()=>{"use strict";const e=window.wp.element,a=window.wp.blocks,l=window.wp.blockEditor,t=window.wp.i18n,o=window.wp.components,s=window.ReactJSXRuntime,n=["core/paragraph","core/heading","core/image"];(0,a.registerBlockType)("acemedia/google-map",{title:(0,t.__)("Google Map","acemedia-map-block"),icon:"location-alt",category:"widgets",attributes:{lat:{type:"number",default:51.5074},lng:{type:"number",default:-.1278},address:{type:"string",default:""},streetViewHeading:{type:"number",default:0},streetViewPitch:{type:"number",default:0},isStreetView:{type:"boolean",default:!1},zoom:{type:"number",default:8},mapStyle:{type:"string",default:""},mapIsImage:{type:"boolean",default:!1},disableMovement:{type:"boolean",default:!!aceMapBlockDefaults.disableMovement},disableZoom:{type:"boolean",default:!!aceMapBlockDefaults.disableZoom},disableLabels:{type:"boolean",default:!!aceMapBlockDefaults.disableLabels},disableUIButtons:{type:"boolean",default:!!aceMapBlockDefaults.disableUIButtons},mapAsBackground:{type:"boolean",default:!1},showMarker:{type:"boolean",default:!0}},edit:({attributes:a,setAttributes:i,isSelected:d})=>{const{lat:c,lng:r,address:g,streetViewHeading:p,streetViewPitch:m,isStreetView:b,zoom:u,mapStyle:f,mapIsImage:h,disableMovement:k,disableZoom:v,disableLabels:y,disableUIButtons:w,mapAsBackground:M}=a,B=(0,e.useRef)(null),_=(0,e.useRef)(null),[x,C]=(0,e.useState)(null),[j,I]=(0,e.useState)(null),[L,D]=(0,e.useState)(null),S=(0,l.useBlockProps)(),P=new google.maps.Geocoder,T=(e,a)=>{P.geocode({location:{lat:e,lng:a}},((e,a)=>{"OK"===a&&e[0]&&i({address:e[0].formatted_address})}))},z=e=>{e.addListener("position_changed",(()=>{const a=e.getPosition();a&&i({lat:a.lat(),lng:a.lng()})})),e.addListener("pov_changed",(()=>{const a=e.getPov();i({streetViewHeading:a.heading,streetViewPitch:a.pitch})}))};return(0,e.useEffect)((()=>{void 0===v&&i({disableZoom:!!aceMapBlockDefaults.disableZoom}),void 0===y&&i({disableLabels:!!aceMapBlockDefaults.disableLabels}),void 0===w&&i({disableUIButtons:!!aceMapBlockDefaults.disableUIButtons}),void 0===k&&i({disableMovement:!!aceMapBlockDefaults.disableMovement})}),[]),(0,e.useEffect)((()=>{if(B.current&&!x){const e=new google.maps.Map(B.current,{zoomControl:!v,center:{lat:c,lng:r},styles:y?[...aceMapBlock.styles[f]||[],{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]}]:aceMapBlock.styles[f]||null,disableDefaultUI:w});C(e);const a=new google.maps.Marker({position:{lat:c,lng:r},map:e,draggable:!0});I(a),e.addListener("click",(e=>{const l=e.latLng.lat(),t=e.latLng.lng();a.setPosition({lat:l,lng:t}),i({lat:l,lng:t}),T(l,t)})),e.addListener("zoom_changed",(()=>{i({zoom:e.getZoom()})}));const l=document.querySelector(".autocomplete-search");if(console.log("Input element found:",l),l){console.log("Input element found:",l);const t=new google.maps.places.Autocomplete(l);t.bindTo("bounds",e),t.addListener("place_changed",(()=>{const l=t.getPlace();if(console.log("Autocomplete place changed:",l),!l.geometry)return void console.log("No geometry available for this place");const o=l.geometry.location.lat(),s=l.geometry.location.lng();e.setCenter({lat:o,lng:s}),a.setPosition({lat:o,lng:s}),i({lat:o,lng:s,address:l.formatted_address||""}),console.log(`New Coordinates: Lat ${o}, Lng ${s}, Address: ${l.formatted_address}`)}))}else console.log("Could not find the input element with class '.autocomplete-search'")}}),[x,c,r,u,f,v,y,w]),(0,e.useEffect)((()=>{if(B.current&&null!==M){const e=new google.maps.Map(B.current,{zoom:u,center:{lat:c,lng:r},styles:y?[...aceMapBlock.styles[f]||[],{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]}]:aceMapBlock.styles[f]||null,draggable:!k,zoomControl:!v,disableDefaultUI:w});C(e);const a=new google.maps.Marker({position:{lat:c,lng:r},map:e,draggable:!0});I(a),a.addListener("dragend",(()=>{const e=a.getPosition().lat(),l=a.getPosition().lng();i({lat:e,lng:l}),T(e,l)})),e.addListener("click",(e=>{const l=B.current.closest(".wp-block[data-block]");if(!l||!l.classList.contains("is-selected"))return void console.log("Block is not selected");console.log("Block is selected");const t=e.latLng.lat(),o=e.latLng.lng();a.setPosition({lat:t,lng:o}),i({lat:t,lng:o}),T(t,o)})),e.addListener("zoom_changed",(()=>{i({zoom:e.getZoom()})}));const l=e.getStreetView();D(l),b&&(l.setPosition({lat:c,lng:r}),l.setPov({heading:p,pitch:m}),l.setVisible(!0),z(l));const t=document.querySelector(".autocomplete-search");if(t){console.log("Input element found:",t);const l=new google.maps.places.Autocomplete(t);l.bindTo("bounds",e),l.addListener("place_changed",(()=>{const t=l.getPlace();if(console.log("Autocomplete place changed:",t),!t.geometry)return void console.log("No geometry available for this place");const o=t.geometry.location.lat(),s=t.geometry.location.lng();e.setCenter({lat:o,lng:s}),a.setPosition({lat:o,lng:s}),i({lat:o,lng:s,address:t.formatted_address||""}),console.log(`New Coordinates: Lat ${o}, Lng ${s}, Address: ${t.formatted_address}`)}))}else console.log("Could not find the input element with class '.autocomplete-search'")}}),[M,b]),(0,e.useEffect)((()=>{x&&(x.setOptions({draggable:!k,zoomControl:!v,disableDefaultUI:w,styles:y?[...aceMapBlock.styles[f]||[],{featureType:"all",elementType:"labels",stylers:[{visibility:"off"}]}]:aceMapBlock.styles[f]||null}),x.setCenter({lat:c,lng:r}),x.setZoom(u)),j&&j.setPosition({lat:c,lng:r})}),[c,r,u,f,k,v,y,w]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l.InspectorControls,{children:(0,s.jsxs)(o.PanelBody,{title:(0,t.__)("Map Settings","acemedia-map-block"),children:[(0,s.jsx)(o.TextControl,{label:(0,t.__)("Latitude","acemedia-map-block"),value:void 0!==c?c:51.5074,onChange:e=>i({lat:parseFloat(e)})}),(0,s.jsx)(o.TextControl,{label:(0,t.__)("Longitude","acemedia-map-block"),value:void 0!==r?r:-.1278,onChange:e=>i({lng:parseFloat(e)})}),(0,s.jsx)(o.TextControl,{label:(0,t.__)("Address","acemedia-map-block"),value:g,disabled:!0}),(0,s.jsx)(o.ToggleControl,{label:(0,t.__)("Show Marker","acemedia-map-block"),checked:void 0===a.showMarker||a.showMarker,onChange:e=>i({showMarker:e})}),(0,s.jsx)(o.RangeControl,{label:(0,t.__)("Zoom Level","acemedia-map-block"),value:void 0!==u?u:8,onChange:e=>i({zoom:e}),min:1,max:20}),(0,s.jsx)(o.ToggleControl,{label:(0,t.__)("Map as Image","acemedia-map-block"),checked:void 0!==h&&h,onChange:e=>i({mapIsImage:e})}),(0,s.jsx)(o.ToggleControl,{label:(0,t.__)("Map as Background","acemedia-map-block"),checked:void 0!==M&&M,onChange:e=>i({mapAsBackground:e})}),!h&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.ToggleControl,{label:(0,t.__)("Is Street View?","acemedia-map-block"),checked:void 0!==b&&b,onChange:()=>{L&&(b?L.setVisible(!1):(L.setPosition({lat:c,lng:r}),L.setPov({heading:p,pitch:m}),L.setVisible(!0),z(L))),i({isStreetView:!b})}}),b&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.TextControl,{label:(0,t.__)("Street View Heading","acemedia-map-block"),value:void 0!==p?p:0,onChange:e=>i({streetViewHeading:parseFloat(e)})}),(0,s.jsx)(o.TextControl,{label:(0,t.__)("Street View Pitch","acemedia-map-block"),value:void 0!==m?m:0,onChange:e=>i({streetViewPitch:parseFloat(e)})})]}),(0,s.jsx)(o.SelectControl,{label:(0,t.__)("Map Style","acemedia-map-block"),value:void 0!==f?f:"",options:[{label:(0,t.__)("Default","acemedia-map-block"),value:""},...Object.keys(aceMapBlock.styles).map((e=>({label:e,value:e})))],onChange:e=>i({mapStyle:e})}),(0,s.jsx)(o.ToggleControl,{label:(0,t.__)("Disable Map Movement","acemedia-map-block"),checked:void 0!==k?k:!!aceMapBlockDefaults.disableMovement,onChange:e=>i({disableMovement:e})}),(0,s.jsx)(o.ToggleControl,{label:(0,t.__)("Disable Zoom","acemedia-map-block"),checked:void 0!==v?v:!!aceMapBlockDefaults.disableZoom,onChange:e=>i({disableZoom:e})}),(0,s.jsx)(o.ToggleControl,{label:(0,t.__)("Disable Labels","acemedia-map-block"),checked:void 0!==y?y:!!aceMapBlockDefaults.disableLabels,onChange:e=>i({disableLabels:e})}),(0,s.jsx)(o.ToggleControl,{label:(0,t.__)("Disable UI Buttons","acemedia-map-block"),checked:void 0!==w?w:!!aceMapBlockDefaults.disableUIButtons,onChange:e=>i({disableUIButtons:e})})]})]})}),(0,s.jsxs)("div",{...S,style:{position:"relative",width:"100%",height:"600px"},children:[!h&&M&&(0,s.jsx)("div",{ref:B,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1}}),M&&(0,s.jsx)("div",{style:{position:"relative",zIndex:2},children:(0,s.jsx)(l.InnerBlocks,{allowedBlocks:n})}),!M&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("input",{ref:_,className:"autocomplete-search",type:"text",placeholder:(0,t.__)("Search for a location","acemedia-map-block"),style:{width:"50%",padding:"8px",top:"10px",position:"absolute",left:"50%",transform:"translateX(-50%)",zIndex:"100",display:d?"block":"none"}}),(0,s.jsx)("div",{ref:B,style:{width:"100%",height:"600px",backgroundColor:"#e5e5e5"}})]})]})]})},save:({attributes:e})=>{const{lat:a=51.5074,lng:o=-.1278,streetViewHeading:n=0,streetViewPitch:i=0,isStreetView:d=!1,zoom:c=8,mapStyle:r="",mapIsImage:g=!1,disableMovement:p=!!aceMapBlockDefaults.disableMovement,disableZoom:m=!!aceMapBlockDefaults.disableZoom,disableLabels:b=!!aceMapBlockDefaults.disableLabels,disableUIButtons:u=!!aceMapBlockDefaults.disableUIButtons,mapAsBackground:f=!1,showMarker:h=!0}=e,k=void 0!==p?p:!!aceMapBlockDefaults.disableMovement,v=void 0!==m?m:!!aceMapBlockDefaults.disableZoom,y=void 0!==b?b:!!aceMapBlockDefaults.disableLabels,w=void 0!==u?u:!!aceMapBlockDefaults.disableUIButtons,M=["google-map",p?"disable-movement":"",m?"disable-zoom":"",b?"disable-labels":"",u?"disable-ui":""].filter(Boolean).join(" "),B={"data-lat":a||0,"data-lng":o||0,"data-sv-heading":n||0,"data-sv-pitch":i||0,"data-is-street-view":d?"true":"false","data-zoom":c||8,"data-map-style":r||"default","data-disable-movement":k?"true":"false","data-disable-zoom":v?"true":"false","data-disable-labels":y?"true":"false","data-disable-ui-buttons":w?"true":"false","data-show-marker":h?"true":"false"};return g?(0,s.jsx)("img",{src:`https://maps.googleapis.com/maps/api/staticmap?center=${a},${o}&zoom=${c}&size=600x400${h?`&markers=color:red%7C${a},${o}`:""}&key=${aceMapBlock.apiKey}`,alt:(0,t.__)("Google Map","acemedia-map-block")}):(0,s.jsxs)("div",{style:{position:"relative",width:"100%",height:"600px"},children:[(0,s.jsx)("div",{className:M,...B,style:{position:f?"absolute":"relative",top:0,left:0,width:"100%",height:"100%"}}),f&&(0,s.jsx)("div",{style:{position:"relative",zIndex:2},children:(0,s.jsx)(l.InnerBlocks.Content,{})})]})}})})();