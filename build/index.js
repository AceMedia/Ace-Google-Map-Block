(()=>{"use strict";const e=window.wp.element,t=window.wp.blocks,s=window.wp.blockEditor,i=window.wp.components,n=window.ReactJSXRuntime;(0,t.registerBlockType)("my-block/google-map",{title:"Google Map Block",icon:"location-alt",category:"widgets",attributes:{lat:{type:"number",default:51.5074},lng:{type:"number",default:-.1278},address:{type:"string",default:""},streetViewHeading:{type:"number",default:0},streetViewPitch:{type:"number",default:0},isStreetView:{type:"boolean",default:!1}},edit:({attributes:t,setAttributes:l})=>{const{lat:a,lng:o,address:r,streetViewHeading:d,streetViewPitch:g,isStreetView:c}=t,p=(0,e.useRef)(null),u=(0,e.useRef)(null),[w,h]=(0,e.useState)(null),[b,m]=(0,e.useState)(null),[V,x]=(0,e.useState)(null),f=new google.maps.Geocoder,v=e=>{e.addListener("position_changed",(()=>{const t=e.getPosition();t&&l({lat:t.lat(),lng:t.lng()})})),e.addListener("pov_changed",(()=>{const t=e.getPov();l({streetViewHeading:t.heading,streetViewPitch:t.pitch})}))};return(0,e.useEffect)((()=>{if(p.current&&!w){const e=new google.maps.Map(p.current,{zoom:10,center:{lat:a,lng:o}});h(e);const t=new google.maps.Marker({position:{lat:a,lng:o},map:e,draggable:!0});m(t);const s=e.getStreetView();if(x(s),s.addListener("visible_changed",(function(){const e=s.getVisible();l({isStreetView:e})})),c&&(s.setPosition({lat:a,lng:o}),s.setPov({heading:d,pitch:g}),s.setVisible(!0),v(s)),e.addListener("click",(e=>{const i=e.latLng.lat(),n=e.latLng.lng();t.setPosition({lat:i,lng:n}),((e,t)=>{f.geocode({location:{lat:e,lng:t}},((e,t)=>{"OK"===t&&e[0]&&l({address:e[0].formatted_address})}))})(i,n),l({lat:i,lng:n,isStreetView:!1}),s.setVisible(!1)})),u.current){const i=new google.maps.places.Autocomplete(u.current);i.bindTo("bounds",e),i.addListener("place_changed",(()=>{const n=i.getPlace();if(!n.geometry||!n.geometry.location)return;const a=n.geometry.location.lat(),o=n.geometry.location.lng();e.setCenter({lat:a,lng:o}),t.setPosition({lat:a,lng:o}),l({lat:a,lng:o,address:n.formatted_address||"",isStreetView:c}),c&&(s.setPosition({lat:a,lng:o}),s.setPov({heading:d,pitch:g}),s.setVisible(!0))}))}}}),[p,w]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.InspectorControls,{children:(0,n.jsxs)(i.PanelBody,{title:"Map Settings",children:[(0,n.jsx)(i.TextControl,{label:"Latitude",value:a,onChange:e=>l({lat:parseFloat(e)})}),(0,n.jsx)(i.TextControl,{label:"Longitude",value:o,onChange:e=>l({lng:parseFloat(e)})}),(0,n.jsx)(i.TextControl,{label:"Address",value:r,disabled:!0}),(0,n.jsx)(i.ToggleControl,{label:"Is Street View?",checked:c,onChange:()=>{V&&(c?V.setVisible(!1):(V.setPosition({lat:a,lng:o}),V.setPov({heading:d,pitch:g}),V.setVisible(!0),v(V))),l({isStreetView:!c})}}),c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.TextControl,{label:"Street View Heading",value:d,onChange:e=>l({streetViewHeading:parseFloat(e)})}),(0,n.jsx)(i.TextControl,{label:"Street View Pitch",value:g,onChange:e=>l({streetViewPitch:parseFloat(e)})})]})]})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{ref:u,type:"text",placeholder:"Search for a location",style:{width:"100%",padding:"8px",marginBottom:"10px"}}),(0,n.jsx)("div",{ref:p,style:{width:"100%",height:"400px",backgroundColor:"#e5e5e5"}})]})]})},save:({attributes:e})=>{const{lat:t,lng:s,address:i,streetViewHeading:l,streetViewPitch:a,isStreetView:o}=e;return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"google-map","data-lat":t,"data-lng":s,"data-sv-heading":l,"data-sv-pitch":a,"data-is-street-view":o,style:{width:"100%",height:"400px"}}),(0,n.jsx)("p",{children:i})]})}})})();